vikunja:
  # ------------------------------------------------------------
  # Controller (bjw-s v1.x: deployment)
  # ------------------------------------------------------------
  controller:
    enabled: true
    type: deployment
    replicas: 3
    revisionHistoryLimit: 3

  # ------------------------------------------------------------
  # Image
  # ------------------------------------------------------------
  image:
    repository: vikunja/vikunja
    tag: latest
    pullPolicy: IfNotPresent

  # ------------------------------------------------------------
  # Service Account (for Workload Identity)
  # ------------------------------------------------------------
  serviceAccount:
    create: true
    name: vikunja
    annotations:
      iam.gke.io/gcp-service-account: vikunja@jithin-gcp-1234.iam.gserviceaccount.com

  automountServiceAccountToken: true

  # ------------------------------------------------------------
  # Service (ClusterIP – Gateway API will target this)
  # ------------------------------------------------------------
  service:
    main:
      enabled: true
      primary: true
      type: ClusterIP
      ports:
        http:
          enabled: true
          primary: true
          port: 3456
          protocol: HTTP

  # ------------------------------------------------------------
  # Environment variables (Vikunja runtime config)
  # NO PASSWORD - using Workload Identity for Cloud SQL
  # ------------------------------------------------------------
  env:
    VIKUNJA_DATABASE_TYPE: postgres
    VIKUNJA_DATABASE_HOST: 127.0.0.1
    VIKUNJA_DATABASE_PORT: "5432"
    VIKUNJA_DATABASE_DATABASE: vikunja
    VIKUNJA_DATABASE_USER: vikunja
    VIKUNJA_SERVICE_INTERFACE: ":3456"
    VIKUNJA_LOG_LEVEL: info
    VIKUNJA_METRICS_ENABLED: "true"
    VIKUNJA_MIGRATION_ENABLED: "true"

  # ------------------------------------------------------------
  # Probes (custom, HTTP-based)
  # ------------------------------------------------------------
  probes:
    liveness:
      enabled: true
      custom: true
      spec:
        httpGet:
          path: /api/v1/info
          port: 3456
        initialDelaySeconds: 30
        periodSeconds: 10
        timeoutSeconds: 2
        failureThreshold: 3

    readiness:
      enabled: true
      custom: true
      spec:
        httpGet:
          path: /api/v1/info
          port: 3456
        initialDelaySeconds: 10
        periodSeconds: 5
        timeoutSeconds: 2
        failureThreshold: 3

  # ------------------------------------------------------------
  # Resources
  # ------------------------------------------------------------
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # ------------------------------------------------------------
  # Persistence (disabled – Cloud SQL used)
  # ------------------------------------------------------------
  persistence:
    data:
      enabled: false
    database:
      enabled: false

  # ------------------------------------------------------------
  # Ingress disabled (Gateway API used)
  # ------------------------------------------------------------
  ingress:
    main:
      enabled: false

  # ------------------------------------------------------------
  # ConfigMaps disabled (using env vars only)
  # ------------------------------------------------------------
  configMaps:
    config:
      enabled: false

  # ------------------------------------------------------------
  # Sidecars (bjw-s v1.x) – Cloud SQL Auth Proxy
  # ------------------------------------------------------------
  sidecars:
    cloudsql-proxy:
      image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.8.0
      imagePullPolicy: IfNotPresent
      args:
        - "--address=127.0.0.1"
        - "--port=5432"
        - "jithin-gcp-1234:us-central1:vikunja-production-db"
      securityContext:
        runAsNonRoot: true
      resources:
        requests:
          cpu: 50m
          memory: 64Mi
        limits:
          cpu: 200m
          memory: 256Mi

  # ------------------------------------------------------------
  # Scheduling & HA
  # ------------------------------------------------------------
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: topology.kubernetes.io/zone
      whenUnsatisfiable: ScheduleAnyway
      labelSelector:
        matchLabels:
          app.kubernetes.io/name: vikunja

  podDisruptionBudget:
    enabled: true
    minAvailable: 1

# ------------------------------------------------------------
# Additional objects (for custom resources if needed)
# ------------------------------------------------------------
additionalObjects: []