vikunja:
  # ------------------------------------------------------------
  # Controller (bjw-s: controller)
  # ------------------------------------------------------------
  controller:
    enabled: true
    type: deployment
    replicas: 3
    revisionHistoryLimit: 3

  # ------------------------------------------------------------
  # Image
  # ------------------------------------------------------------
  image:
    repository: ghcr.io/go-vikunja/vikunja
    tag: latest
    pullPolicy: IfNotPresent

  # ------------------------------------------------------------
  # Service Account (Helm-managed, patched for WI)
  # ------------------------------------------------------------
  serviceAccount:
    create: true
    name: vikunja

  automountServiceAccountToken: true

  # ------------------------------------------------------------
  # Service (ClusterIP – Gateway API will target this)
  # ------------------------------------------------------------
  service:
    main:
      enabled: true
      primary: true
      type: ClusterIP
      ports:
        http:
          enabled: true
          primary: true
          port: 3456
          protocol: HTTP

  # ------------------------------------------------------------
  # Environment variables (Vikunja runtime config)
  # ------------------------------------------------------------
  env:
    VIKUNJA_DATABASE_TYPE: postgres
    VIKUNJA_DATABASE_HOST: 127.0.0.1
    VIKUNJA_DATABASE_PORT: "5432"
    VIKUNJA_DATABASE_DATABASE: vikunja
    VIKUNJA_DATABASE_USER: vikunja

    VIKUNJA_SERVICE_INTERFACE: ":3456"
    VIKUNJA_LOG_LEVEL: info
    VIKUNJA_METRICS_ENABLED: "true"
    VIKUNJA_MIGRATION_ENABLED: "true"

  # ------------------------------------------------------------
  # Probes (custom, HTTP-based)
  # ------------------------------------------------------------
  probes:
    liveness:
      enabled: true
      custom: true
      spec:
        httpGet:
          path: /api/v1/info
          port: http
        initialDelaySeconds: 30
        periodSeconds: 10
        timeoutSeconds: 2
        failureThreshold: 3

    readiness:
      enabled: true
      custom: true
      spec:
        httpGet:
          path: /api/v1/info
          port: http
        initialDelaySeconds: 10
        periodSeconds: 5
        timeoutSeconds: 2
        failureThreshold: 3

  # ------------------------------------------------------------
  # Resources
  # ------------------------------------------------------------
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # ------------------------------------------------------------
  # Persistence (disabled – Cloud SQL used)
  # ------------------------------------------------------------
  persistence:
    data:
      enabled: false
    database:
      enabled: false

  # ------------------------------------------------------------
  # Ingress disabled (Gateway API used)
  # ------------------------------------------------------------
  ingress:
    main:
      enabled: false

  # ------------------------------------------------------------
  # Gateway API (HTTPRoute managed by ArgoCD separately OR here)
  # ------------------------------------------------------------
  route:
    main:
      enabled: false   # keep false if route is managed as a separate app

  # ------------------------------------------------------------
  # Sidecars (bjw-s: sidecars) – Cloud SQL Auth Proxy
  # ------------------------------------------------------------
  sidecars:
    cloudsql-proxy:
      image:
        repository: gcr.io/cloud-sql-connectors/cloud-sql-proxy
        tag: "2.8.0"
        pullPolicy: IfNotPresent
      args:
        - "--address=127.0.0.1"
        - "--port=5432"
        - "jithin-gcp-1234:us-central1:vikunja-production-db"
      securityContext:
        runAsNonRoot: true
      resources:
        requests:
          cpu: 50m
          memory: 64Mi
        limits:
          cpu: 200m
          memory: 256Mi

  # ------------------------------------------------------------
  # Scheduling & HA
  # ------------------------------------------------------------
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: topology.kubernetes.io/zone
      whenUnsatisfiable: ScheduleAnyway
      labelSelector:
        matchLabels:
          app.kubernetes.io/name: vikunja

  podDisruptionBudget:
    enabled: true
    minAvailable: 1

  # ------------------------------------------------------------
  # Disable configMap-based config (env-only)
  # ------------------------------------------------------------
  configMaps:
    config:
      enabled: false
      data: {}
